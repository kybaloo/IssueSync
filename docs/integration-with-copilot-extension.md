<!--filepath: d:\Projects\Personal\IssueSync\docs\integration-with-copilot-extension.md -->
# IssueSync Integration in a VS Code Extension Using Copilot

This guide explains how to integrate the IssueSync library into a VS Code extension that uses Copilot to generate tasks. The goal is to allow users to create tasks from GitHub issues using both IssueSync to retrieve issue data and Copilot to transform them into intelligent tasks.

## Prerequisites

- An existing VS Code extension that generates tasks with Copilot
- Node.js and npm installed

## Integration Steps

### 1. Install IssueSync

Add IssueSync as a dependency to your VS Code extension:

```bash
npm install --save issuesync
```

### 2. Configure GitHub Authentication

Add a configuration to store the GitHub token:

```javascript
// In your extension's package.json file
{
  "contributes": {
    "configuration": {
      "title": "Your Extension",
      "properties": {
        "yourExtension.githubToken": {
          "type": "string",
          "default": "",
          "description": "GitHub token to access issues (scope: repo)"
        }
      }
    }
  }
}
```

### 3. Initialize IssueSync

Add the following code in your extension to initialize IssueSync:

```javascript
const issueSync = require('issuesync');

// In your activation function
function activate(context) {
  // Get the GitHub token from settings
  const config = vscode.workspace.getConfiguration('yourExtension');
  const githubToken = config.get('githubToken');
  
  // Initialize IssueSync if token is available
  if (githubToken) {
    issueSync.init({ token: githubToken });
  }
  
  // ... rest of your activation code
}
```

### 4. Add a Command to Retrieve Issues

```javascript
// Register a command to retrieve issues
const fetchIssuesCommand = vscode.commands.registerCommand('yourExtension.fetchIssues', async () => {
  try {
    // Check if token is configured
    const config = vscode.workspace.getConfiguration('yourExtension');
    const githubToken = config.get('githubToken');
    
    if (!githubToken) {
      vscode.window.showErrorMessage('GitHub token not configured');
      return;
    }
    
    // Ask for repository details
    const owner = await vscode.window.showInputBox({ prompt: 'GitHub repository owner' });
    if (!owner) return;
    
    const repo = await vscode.window.showInputBox({ prompt: 'GitHub repository name' });
    if (!repo) return;
    
    // Retrieve issues with IssueSync
    const issues = await issueSync.listIssues({
      owner,
      repo,
      state: 'open'
    });
    
    if (issues.length === 0) {
      vscode.window.showInformationMessage('No issues found');
      return;
    }
    
    // Allow user to select issues
    const selectedIssue = await vscode.window.showQuickPick(
      issues.map(issue => ({        label: issue.title,
        description: `#${issue.number}`,
        issue: issue
      })),
      { placeHolder: 'Select an issue' }
    );
    
    if (!selectedIssue) return;
    
    // Generate a task with Copilot
    await generateTaskWithCopilot(selectedIssue.issue);
    
  } catch (error) {
    vscode.window.showErrorMessage(`Error: ${error.message}`);
  }
});

context.subscriptions.push(fetchIssuesCommand);
```

### 5. Integrate with Copilot API

Here's how you could integrate the retrieved issues with the Copilot API to generate tasks:

```javascript
/**
 * Generates a task from a GitHub issue using Copilot
 * @param {Object} issue - GitHub issue retrieved via IssueSync
 */
async function generateTaskWithCopilot(issue) {
  // Format the issue for Copilot
  const issueData = {
    title: issue.title,
    body: issue.body,
    labels: issue.labels.map(label => label.name),
    number: issue.number,
    url: issue.html_url
  };
  
  // Assume your extension already exposes an API to generate tasks with Copilot
  const taskDescription = `
    Title: ${issueData.title}
    Description: ${issueData.body || 'No description'}
    Labels: ${issueData.labels.join(', ')}
    URL: ${issueData.url}
  `;
  
  // Call to your existing API that uses Copilot
  // This is an example - replace with your own API
  const generatedTask = await yourCopilotAPI.generateTaskFromDescription(taskDescription);
  
  // Create the tasks.json file with the generated task
  await createTaskFile(generatedTask, issue);
  
  vscode.window.showInformationMessage(`Task created for issue #${issue.number}`);
}
```

### 6. Create the tasks.json File

```javascript
/**
 * Creates or updates the tasks.json file with the new task
 * @param {Object} generatedTask - Task generated by Copilot
 * @param {Object} issue - Original GitHub issue
 */
async function createTaskFile(generatedTask, issue) {
  // Check if a workspace is open
  if (!vscode.workspace.workspaceFolders || vscode.workspace.workspaceFolders.length === 0) {
    throw new Error('No workspace open');
  }
  
  const workspaceFolder = vscode.workspace.workspaceFolders[0];
  const tasksJsonPath = vscode.Uri.joinPath(workspaceFolder.uri, '.vscode', 'tasks.json');
  
  // Read existing tasks.json file or create a template
  let tasksConfig;
  try {
    const content = await vscode.workspace.fs.readFile(tasksJsonPath);
    tasksConfig = JSON.parse(content.toString());
  } catch {
    // File doesn't exist, create a template
    tasksConfig = {
      version: '2.0.0',
      tasks: []
    };
    
    // Ensure .vscode folder exists
    await vscode.workspace.fs.createDirectory(
      vscode.Uri.joinPath(workspaceFolder.uri, '.vscode')
    );
  }
  
  // Add the new task with issue metadata
  const task = {
    ...generatedTask,
    metadata: {
      githubIssue: {
        number: issue.number,
        title: issue.title,        url: issue.html_url
      }
    }
  };
  
  tasksConfig.tasks.push(task);
  
  // Write the updated file
  await vscode.workspace.fs.writeFile(
    tasksJsonPath,
    Buffer.from(JSON.stringify(tasksConfig, null, 2))
  );
}
```

## Complete Example

For a complete integration example, see [the example source code](../examples/vscode-copilot-tasks-extension.js) provided with IssueSync.

## Benefits of This Integration

1. **Real Data**: Uses real GitHub issues as the basis for tasks
2. **Preserved Metadata**: Maintains links to original issues
3. **Seamless Interaction**: User doesn't need to leave VS Code
4. **Intelligent Generation**: Copilot can analyze issue content to create tailored tasks
5. **Complete Solution**: Combines the strengths of IssueSync and Copilot in a single experience

## Implementation Tips

- Properly handle authentication and API errors
- Add an option to refresh issues without restarting the extension
- Allow users to synchronize multiple issues in a single operation
- Add an option to update tasks when issues are updated on GitHub
- Consider using IssueSync's filtering features to target specific issues
